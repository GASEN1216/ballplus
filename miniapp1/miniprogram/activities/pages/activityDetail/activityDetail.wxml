<view class="activity-detail-container">
  <!-- æ´»åŠ¨ä¿¡æ¯ -->
  <view class="activity-detail">
    <image src="{{activity.avatar}}" class="activity-cover"></image>
    <text class="activity-title">{{activity.name}}</text>
    <text class="activity-meta">ğŸ“… {{activity.eventDate}} {{activity.weekDay}} {{activity.eventTime}}-{{activity.eventTimee}}</text>
    <text class="activity-meta">ğŸ“ {{activity.location}}</text>
    <text class="activity-meta location-detail">ğŸ“ {{activity.locationDetail}}</text>
    <text class="activity-meta">ğŸ‘¥ {{activity.participants}}/{{activity.totalParticipants}}</text>
    <text class="activity-remarks">ğŸ“¢ {{activity.remarks}}</text>
    <text class="activity-meta">ğŸ“ {{activity.phoneNumber}}</text>
    <!-- æ¶ˆè´¹æ¨¡å¼ -->
    <text class="activity-meta" wx:if="{{activity.feeMode !== 0}}">
      ğŸ’° {{feeModeText}} {{activity.feeMode === 2 ? activity.fee + 'å…ƒ' : ''}}
    </text>

    <!-- æ ‡ç­¾éƒ¨åˆ† -->
    <view class="tag-container">
      <view class="tag type-tag">{{typeText}}</view>
      <view class="tag limits-tag">{{limitsText}}</view>
      <view class="tag level-tag">{{levelText}}</view>
    </view>
  </view>

  <!-- å‚ä¸è€…ä¿¡æ¯ -->
  <view class="participants-section">
    <text class="section-title">å‚ä¸è€…:</text>
    <view class="participants-container">
      <block wx:for="{{activity.persons}}" wx:key="index">
        <view class="participant-box">
          <image src="{{item.avatar}}" class="participant-avatar"  bindtap="goToInfo" data-userid="{{item.userId}}"></image>
        </view>
      </block>
    </view>
  </view>
  
  <!-- æŠ•è¯‰è®°å½•åˆ—è¡¨ï¼Œåªåœ¨æ´»åŠ¨å·²å®Œæˆæ—¶æ˜¾ç¤º -->
  <view class="complaints-section" wx:if="{{activity.state === 1}}">
    <text class="section-title">æŠ•è¯‰è®°å½•</text>
    <view class="complaints-container" wx:if="{{complaints.length > 0}}">
      <view class="complaint-item" wx:for="{{complaints}}" wx:key="id">
        <view class="complaint-header">
          <view class="complainer-info">
            <image src="{{item.complainerAvatar}}" class="complaint-avatar" bindtap="goToInfo" data-userid="{{item.complainerId}}"></image>
            <text class="complaint-name">{{item.complainerName}}</text>
          </view>
          <text class="complaint-time">{{item.createTime}}</text>
        </view>
        <view class="complaint-content">
          <text>æŠ•è¯‰äº†</text>
          <image src="{{item.complainedAvatar}}" class="complaint-avatar small" bindtap="goToInfo" data-userid="{{item.complainedId}}"></image>
          <text class="complaint-name">{{item.complainedName}}</text>
        </view>
        <view class="complaint-reason">{{item.content}}</view>
        <view class="complaint-status" wx:if="{{item.status === 1}}">
          <text></text>
          <text class="status-tag valid">æœ‰æ•ˆæŠ•è¯‰</text>
        </view>
        <view class="complaint-status" wx:elif="{{item.status === 2}}">
          <text class="status-tag invalid">æ— æ•ˆæŠ•è¯‰</text>
          <text class="reject-reason">åŸå› : {{item.rejectReason}}</text>
        </view>
        <view class="complaint-status" wx:else>
          <text></text>
          <text class="status-tag pending">å¤„ç†ä¸­</text>
        </view>
      </view>
    </view>
    <view class="no-complaints" wx:else>
      <text>æš‚æ— æŠ•è¯‰è®°å½•</text>
    </view>
  </view>

  <!-- åº•éƒ¨æŒ‰é’® -->
  <view class="action-buttons" wx:if="{{!isPastEvent && isStateZero && !ifNotification}}">
    <view class="main-buttons">
      <button wx:if="{{isCreator}}" bindtap="cancelActivity" class="cancel-btn">æˆ‘è¦å–æ¶ˆ</button>
      <button wx:if="{{!isCreator && isJoined}}" bindtap="exitActivity" class="exit-btn">æˆ‘è¦é€€å‡º</button>
      <button wx:if="{{!isCreator && !isJoined}}" bindtap="joinActivity" class="join-btn">æˆ‘è¦å‚åŠ </button>
    </view>
    <button class="share-button" open-type="share">
      <image class="share-icon" src="http://sunsetchat.top/icon/share.png"></image>
    </button>
  </view>
  
  <!-- æ´»åŠ¨å·²å®Œæˆï¼Œæ˜¾ç¤ºæŠ•è¯‰æŒ‰é’® -->
  <view class="action-buttons" wx:if="{{activity.state === 1 && isJoined && canComplaint}}">
    <view class="main-buttons">
      <button bindtap="goToComplaint" class="complaint-btn">æˆ‘è¦æŠ•è¯‰</button>
    </view>
  </view>
  
  <!-- å–æ¶ˆæ´»åŠ¨è‡ªå®šä¹‰å¼¹çª— -->
  <view class="modal-mask" wx:if="{{showCancelModal}}" bindtap="closeCancelModal"></view>
  <view class="modal-dialog" wx:if="{{showCancelModal}}">
    <view class="modal-title">å–æ¶ˆæ´»åŠ¨</view>
    <view class="modal-content">
      <view class="modal-input-container">
        <textarea class="modal-input" bindinput="onCancelReasonInput" bindfocus="onCancelReasonFocus" value="{{cancelReason}}" placeholder="è¯·è¾“å…¥å–æ¶ˆæ´»åŠ¨çš„åŸå› ..." placeholder-class="modal-placeholder" maxlength="20" auto-focus></textarea>
        <view class="word-count">{{cancelReason.length}}/20</view>
      </view>
      <!-- å¸¸ç”¨å–æ¶ˆåŸå› æŒ‰é’® -->
      <view class="common-reasons">
        <view class="common-reason-title">å¸¸ç”¨åŸå› ï¼š</view>
        <view class="common-reason-buttons">
          <view 
            wx:for="{{commonReasons}}" 
            wx:key="index" 
            class="common-reason-btn" 
            bindtap="selectCommonReason" 
            data-index="{{index}}">
            {{item}}
          </view>
        </view>
      </view>
    </view>
    <view class="modal-footer">
      <view class="modal-btn modal-btn-cancel" bindtap="closeCancelModal">å–æ¶ˆ</view>
      <view class="modal-btn modal-btn-confirm" bindtap="confirmCancelActivity">ç¡®å®š</view>
    </view>
  </view>
</view>
