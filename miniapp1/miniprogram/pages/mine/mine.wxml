<view class="container">

  <!-- é¡¶éƒ¨å›ºå®šæ  -->
  <view class="header">
    <view wx:if="{{isLoggedin}}" class="user-info">
      <image src="{{profilePic}}" class="avatar" bindtap="goToInfo"></image>
      <!-- ç”¨æˆ·æ–‡æœ¬ä¿¡æ¯ -->
      <view class="user-text">
        <text class="nickname" bindtap="goToInfo">{{nickname}}</text>
        <view class="level-exp-container">
          <!-- ç­‰çº§ - å°ç‰Œå­ ç»éªŒå€¼-->
          <text class="level-text">LV.{{userData.grade}}</text>
          <text class="exp-text">{{userData.exp}} / {{userData.grade * 10}}</text>
        </view>
        <!-- ç»éªŒ - é•¿æ¡è¿›åº¦æ¡ -->
        <view class="form-item score-item" style="width: 122rpx; display: block; box-sizing: border-box">
          <view class="exp-bar-container">
            <view class="exp-bar">
              <view class="exp-progress" style="width: {{expWidth}};"></view>
            </view>
          </view>
        </view>
      </view>
    </view>
    <view class="header-btns">
      <button open-type="contact" class="customer-service-btn" style="width: 64rpx; display: block; box-sizing: border-box; left: 0rpx; top: 0rpx">
        <image src="../../icon/customer-service2.png" class="header-icon" mode="aspectFit"></image>
      </button>
      <view class="settings-btn" bindtap="navigateToSettings">
        <image src="../../icon/settings.png" class="header-icon" mode="aspectFit"></image>
      </view>
    </view>
  </view>

  <!-- ä¸»è¦å†…å®¹åŒº -->
  <view class="main-content">
    <!-- æ´»åŠ¨å€’è®¡æ—¶å¡ç‰‡ - å¯æŠ˜å  -->
    <view class="card activity-time-card">
      <view class="card-header">
        <view class="card-title">
          <image src="../../icon/clock.png" class="card-icon" mode="aspectFit"></image>
          <text>æ´»åŠ¨å€’è®¡æ—¶</text>
        </view>
      </view>
      
      <view wx:if="{{activities[0].remainingTime}}" class="card-content">
        <text class="activity-remaining-time">{{activities[0].remainingTime}}</text>
        <view class="activity-summary" bindtap="toggleActivityList" data-id="{{activities[0].id}}">
          <view class="activity-summary-text">{{activities[0].name}}</view>
          <image src="../../icon/arrow-right.png" class="arrow-icon {{showActivityList ? 'arrow-down' : ''}}" mode="aspectFit"></image>
        </view>
      </view>
      <view wx:else class="card-content">
        <image src="../../icon/quote.png" class="quote-icon" mode="aspectFit"></image>
        <text class="quote-text">ã€Œæ­¤åˆ» é’å¤©æ— ç‰‡äº‘ã€</text>
      </view>
      
      <!-- è¿‘æœŸæ´»åŠ¨åˆ—è¡¨ - æŠ˜å å†…å®¹ -->
      <view class="recent-activities-list {{showActivityList ? 'show' : 'hide'}}">
        <block wx:if="{{activities.length > 0}}">
          <block wx:for="{{activities}}" wx:key="index">
            <view class="recent-activity-item" bindtap="viewActivityDetail" data-id="{{item.id}}">
              <image src="{{item.avatar}}" class="activity-avatar"></image>
              <view class="activity-details">
                <text class="activity-name">{{item.name}}</text>
                <text class="activity-meta">ğŸ“… {{item.eventDate}} {{item.weekDay}} {{item.eventTime}}-{{item.eventTimee}}</text>
                <text class="activity-meta">ğŸ“ {{item.location}}</text>
                <text class="activity-meta">ğŸ‘¥ {{item.participants}}/{{item.totalParticipants}}</text>
              </view>
              <view class="activity-distance">
                <text>{{item.distance}}</text>
              </view>
            </view>
          </block>
        </block>
        <view wx:else class="empty-activities">
          <text class="empty-text">æš‚æ— è¿‘æœŸæ´»åŠ¨</text>
        </view>
      </view>
    </view>
    
    <!-- åŠŸèƒ½èœå•åŒºåŸŸ -->
    <view class="menu-section">
      <view class="menu-row">
        <view class="menu-item" bindtap="toGdmap">
          <image src="../../icon/location.png" class="menu-icon" mode="aspectFit"></image>
          <text class="menu-text">åœ°å›¾</text>
        </view>
        <view class="menu-item" bindtap="toFriends">
          <image src="../../icon/friends.png" class="menu-icon" mode="aspectFit"></image>
          <text class="menu-text">å¥½å‹</text>
        </view>
        <view class="menu-item" bindtap="toPointsMall">
          <image src="../../icon/points.png" class="menu-icon" mode="aspectFit"></image>
          <text class="menu-text">èµ›ç‚¹å•†åŸ</text>
        </view>
        <view class="menu-item" bindtap="goToEditInfo">
          <image src="../../icon/profile.png" class="menu-icon" mode="aspectFit"></image>
          <text class="menu-text">èµ„æ–™ç¼–è¾‘</text>
        </view>
      </view>
    </view>

    <!-- æ´»åŠ¨ç®¡ç†å¡ç‰‡ -->
    <view class="card activity-card">
      <view class="card-title">
        <image src="../../icon/activity.png" class="card-icon" mode="aspectFit"></image>
        <text>æ´»åŠ¨ç®¡ç†</text>
      </view>
      <view class="menu-row">
        <view class="menu-item" bindtap="goToActivities" data-tab="all">
          <image src="../../icon/activities.png" class="menu-icon" mode="aspectFit"></image>
          <text class="menu-text">å…¨éƒ¨æ´»åŠ¨</text>
        </view>
        <view class="menu-item" bindtap="goToActivities" data-tab="0">
          <image src="../../icon/departure.png" class="menu-icon" mode="aspectFit"></image>
          <text class="menu-text">å¾…å‡ºå‘</text>
        </view>
        <view class="menu-item" bindtap="goToActivities" data-tab="1">
          <image src="../../icon/review.png" class="menu-icon" mode="aspectFit"></image>
          <text class="menu-text">å·²å®Œæˆ</text>
        </view>
        <view class="menu-item" bindtap="goToActivities" data-tab="2">
          <image src="../../icon/cancel.png" class="menu-icon" mode="aspectFit"></image>
          <text class="menu-text">å·²å–æ¶ˆ</text>
        </view>
      </view>
    </view>
    
    <!-- å¥½å‹ç®¡ç†å¡ç‰‡ -->
    <view class="card friends-card">
      <view class="card-title">
        <image src="../../icon/friends.png" class="card-icon" mode="aspectFit"></image>
        <text>å¥½å‹ç®¡ç†</text>
      </view>
      <view class="menu-row">
        <view class="menu-item" bindtap="toFriends">
          <image src="../../icon/friends.png" class="menu-icon" mode="aspectFit"></image>
          <text class="menu-text">å¥½å‹</text>
        </view>
        <view class="menu-item" bindtap="goToAddFriend">
          <image src="../../icon/add-friend.png" class="menu-icon" mode="aspectFit"></image>
          <text class="menu-text">æ·»åŠ å¥½å‹</text>
        </view>
        <view class="menu-item" bindtap="viewSentRequests">
          <image src="../../icon/my-request.png" class="menu-icon" mode="aspectFit"></image>
          <text class="menu-text">æˆ‘çš„ç”³è¯·</text>
        </view>
        <view class="menu-item" bindtap="viewFriendRequests">
          <image src="../../icon/friend-request.png" class="menu-icon" mode="aspectFit"></image>
          <text class="menu-text">å¥½å‹ç”³è¯·</text>
        </view>
      </view>
    </view>
    
    <!-- çƒå›ç®¡ç†å¡ç‰‡ -->
    <view class="card forum-card">
      <view class="card-title">
        <image src="../../icon/basketball.png" class="card-icon" mode="aspectFit"></image>
        <text>çƒå›ç®¡ç†</text>
      </view>
      <view class="menu-row">
        <view class="menu-item" bindtap="goToForum">
          <image src="../../icon/home-icon.png" class="menu-icon" mode="aspectFit"></image>
          <text class="menu-text">çƒå›</text>
        </view>
        <view class="menu-item" bindtap="createPost">
          <image src="../../icon/add.png" class="menu-icon" mode="aspectFit"></image>
          <text class="menu-text">å‘å¸–</text>
        </view>
        <view class="menu-item" bindtap="goToMyPosts">
          <image src="../../icon/profile-icon.png" class="menu-icon" mode="aspectFit"></image>
          <text class="menu-text">æˆ‘çš„å¸–å­</text>
        </view>
        <view class="menu-item" bindtap="goToMyComments">
          <image src="../../icon/reply.png" class="menu-icon" mode="aspectFit"></image>
          <text class="menu-text">æˆ‘çš„è¯„è®º</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç™»å½•æŒ‰é’® -->
  <button wx:if="{{!isLoggedin}}" class="login-btn" bindtap="onLoginButtonClick">ç™»å½•</button>

  <!-- Token éªŒè¯ -->
  <!-- <view wx:if="{{isLoggedin}}">
    <button class="token-button" bindtap="onTokenButtonClick">éªŒè¯Token</button>
    <text class="token-status">{{tokenStatus}}</text>
  </view> -->

</view>